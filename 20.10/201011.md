201011_TIL
===

스터디 정리
---
오늘은 내가 궁금했던 내용을 주제로 스터디를 하는 날이었다. 브라우저가 어떻게 렌더링 되는지, 이벤트가 어떻게 발생하고 처리되는지 등 html, javascript, css 코드가 사용자의 눈에 보이기까지의 과정을 한 번 훑어보는 공부를 했다. 의무감으로 하는 공부가 아니라 호기심을 해결하기 위한 공부를 하는 것이어서 너무 재밌었다. 오늘 공부한 내용중에 내가 가장 기억에 남는 부분을 정리해봐야겠다.

1. 웹브라우저의 다중프로세서 아키텍처

    크롬의 각각의 탭은 별개의 렌더러 프로세스를 갖는다. 왜 각각의 스레드를 갖지 않고, 별개의 프로세스를 가질까?

    * 장점: 각각의 사이트를 "격리"시킬 수 있다. 한 사이트는 동의 없이 다른 사이트의 데이터에 접근할 수 없어야한다는 웹의 "동일출처 정책"으로 인해 각 사이트의 데이터들을 격리시켜야 하는데, 이 정책을 실현하기 위한 가장 효과적인 방법은 프로세스를 격리하는 것이기 때문이다. 또한, 하나의 택이 죽어도 다른 탭을 실행시킬 수 있는 것은 각 탭이 프로세스로 실행이되기 때문이다.
    * 단점: 프로세스는 전용메모리 공간을 사용하기 때문에 메모리 사용량이 늘어난다. 따라서, 이를 보완하기 위해서 CPU 성능에 따라 프로세스의 개수가 한계점에 들어가면 여러탭을 하나의 프로세스를 합치는 작업을 하기도 한다.

2. 브라우저 엔진과 자바스크립트 엔진
    
    엔진이란, 다른 프로그램을 위해 핵심적이고 본질적인 기능을 수행하는 프로그램을 말한다. 웹브라우저를 실행시키는데 중요한 엔진은, 브라우저 엔진과 자바스크립트 엔진이있다. 브라우저 엔진은 HTML, CSS 파일을 파싱하여 DOM트리를 구축하는 역할을 한며, 게코/블링크/웹키트 등이 이에 포함된다. 자바스크립트 엔진은 자바스크립트 코드를 해석하고 실행시켜주는 역할을 하는데, v8이 대표적이다.

3. `index.html`이 실행되는 과정은?

    렌더링엔진의 HTML파서가 DOM을 생성하던 중, script 태그를 만나면 자바스크립트 코드를 실행시키기 위해 제어 권한을 자바스크립트 엔진에게 넘겨준다. 이 때, 문서의 파싱은 중단된다. 스크립트가 외부에 있는 경우, 네트워크로부터 자원을 가져와야하기 때문에, 이 또한 실시간으로 처리되고 자원을 받을 때까지 파싱은 중단된다.
    
4. 이벤트 버블링과 이벤트 위임이란?

    한 요소에서 이벤트가 발생하면 이 요소에 할당된 핸들러가 작동되고, 이어서 부모요소의 핸들러가 작동하는 것을 말한다. 가장 최상단의 조상요소를 만날 때까지 이 과정을 반복하는 것을 "이벤트 버블링"이라고 한다.

    요소마다 핸들러를 할당하지 않고, 요소의 공통조상에 이벤트 핸들러를 하나만 할당해도 되는것을 이벤트 위임이라고 한다.

5. 이벤트루프란?

    자바스크립트는 싱글스레드 언어이다. 그렇지만, 비동기적으로 처리함으로서 동시성을 지원한다. 이 것이 가능한 이유는 무엇일까?

    함수가 호출되면 함수의 실행컨텍스트가 오브젝트 형태로 자바스크립트 엔진의 콜스택에 쌓이게 된다. 이 때, 바로 실행될 수 없는, 예를 들어 setTimeout의 콜백 같은 것들은 call stack에 쌓이는 것이 아니라 이벤트큐에 쌓이게 된다. (이벤트큐는, 태스크큐, 매크로태스크큐, 콜백큐와 같은 말이다.) 

    이벤트 루프는 계속 돌면서 현재실행중인 태스크가 없는지, 태스크큐에 태스크가 있는지를 반복적으로 확인한다.

    마이크로태스큐는 우선순위가 더 높은 큐로, promise의 then의 콜백함수등을 실행시킨다. 

    (아무래도 이벤트루프는 한번더 공부해야겠다.)